require_relative "#{Dir.getwd}/etl_step/100_get_raw_responses/helpers/init.rb"
db = ConnectToDB.call('api_responses')

list_of_repo = CreateRepoList.call

source CallBestGemsApi, list_of_repo, 'daily_download_trend'

destination SaveRecordToDB, db, 'gems_raw_responses_daily_download_trend'

post_process do
  results = CountProcessedRecords.call(db, 'gems_raw_responses_daily_download_trend')
  puts "Total processed records: #{results}."
end
